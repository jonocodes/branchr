<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  <title>Branchr</title>
</head>

<body>
  <!-- <h1>Branchr</h1> -->

  <div class="right">
    Server time: {{time}}
    <!-- <br />Repo: Local -->
  </div>

  <h2>{{serviceName}}</h2>

  <table>
    <tr><th>branch</th><th>last commit</th><th>actions</th>
      <th>watch</th><th>status</th><th>stack</th></tr>
    {{#each branches}}
      {{> branchrow}}
    {{/each}}
  </table>

  <h2>Log</h2>
  {{#each log}}
    {{> logarea}}
  {{/each}}

</body>

<template name="branchrow">
  <tr>
    <td>{{branch}}</td>
    <td>
      <div class="commit">
      {{#with lastCommit}}
        <img src={{gravatar}} width=15> <span class=checksum>{{checksum}}</span> {{date}}<br />
        {{title}}
      {{/with}}
      </div>
    </td>
    <td>

      <button class="log"><i class="fa fa-book {{#if isLogging branch}}fa-rotate-90{{/if}}"></i></button>

      {{#if isWorking status}}
        <button class="stop"><i class="fa fa-spinner fa-spin"></i></button>
      {{else}}
        {{#if running}}
          <button class="stop"><i class="fa fa-stop"></i></button>
        {{else}}
          <button class="start"><i class="fa fa-play"></i></button>
        {{/if}}
      {{/if}}
    </td>
    <td class="center">
      <input type="checkbox" class="watchbox" checked="{{isWatching}}">
    </td>
    <td>
      <!-- {{#if triggered}}
        triggered {{triggered}}<br/>
      {{/if}} -->
      {{#if running}}
        {{uptime}}
      {{else}}
        {{status}}
      {{/if}}
    </td>
    <td>
      {{#if running}}
        {{#each objectToPairs stack}}
          <b>{{key}}</b>
          <ul>
          {{#each objectToPairs value}}
            <li>
              {{#if isLink key}}
                <a href={{address key value}}>{{address key value}}</a>
              {{else}}
                {{address key value}}
              {{/if}}
            </li>
          {{/each}}
          </ul>
        {{/each}}
      {{else}}
        -
      {{/if}}
    </td>
  </tr>
</template>

<template name="logarea">
  Branch: {{branch}}<br/>
  <!-- {{#if triggered}} -->
    Triggered: {{triggered}} <!-- {{startTime}} --><br/>
  <!-- {{/if}} -->
  Time: {{time}}
  <pre>{{log}}</pre>

</template>
